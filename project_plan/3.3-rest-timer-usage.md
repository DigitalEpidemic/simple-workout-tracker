# Rest Timer Usage Guide

## How to Navigate to the Rest Timer

### From Any Screen

```typescript
import { useRouter } from 'expo-router';

const router = useRouter();

// Navigate to rest timer with 90 second duration
router.push('/rest-timer?duration=90');
```

### Example Integration in Exercise Detail Screen

When a user completes a set, you might want to automatically start the rest timer:

```typescript
const handleToggleComplete = async (setId: string, completed: boolean) => {
  await toggleSetCompletion(setId, completed);

  // If completing a set (not un-completing), start rest timer
  if (completed) {
    // Use default 90 seconds, or a custom duration
    router.push('/rest-timer?duration=90');
  }
};
```

### Example with User Settings (Future Phase 4.6)

```typescript
// After Phase 4.6 implements user settings
const defaultRestTime = useUserSettings().defaultRestTime; // e.g., 90, 120, etc.

const handleSetComplete = async (setId: string) => {
  await toggleSetCompletion(setId, true);
  router.push(`/rest-timer?duration=${defaultRestTime}`);
};
```

### Common Rest Timer Durations

```typescript
// Light exercises (isolation, cardio)
router.push('/rest-timer?duration=60');  // 1 minute

// Moderate exercises (bodyweight, moderate weight)
router.push('/rest-timer?duration=90');  // 1.5 minutes (default)

// Heavy compound lifts (squats, deadlifts, bench)
router.push('/rest-timer?duration=180'); // 3 minutes

// Powerlifting / maximal strength
router.push('/rest-timer?duration=300'); // 5 minutes
```

## User Flow

1. User completes a set in Exercise Detail screen
2. App navigates to Rest Timer modal (overlays current screen)
3. Timer counts down with visual progress
4. User can:
   - Pause/Resume the timer
   - Add 30 seconds
   - Skip rest entirely
5. On completion:
   - Haptic feedback (double vibration)
   - "Complete!" message displayed
   - Auto-dismiss after 1 second
6. User returns to Exercise Detail screen to continue workout

## Background Behavior

The rest timer continues running even if:
- User switches to another app
- User locks the device
- User receives a phone call

When the user returns to the app:
- Timer shows accurate remaining time
- If timer completed while backgrounded, completion feedback is shown
- Auto-dismiss proceeds normally

## Implementation Notes

### Dismissal
The timer can be dismissed in three ways:
1. **Skip Button**: User manually skips rest
2. **X Button (top-left)**: User closes modal
3. **Auto-dismiss**: Timer completes and auto-closes after 1 second

All methods call `router.back()` which returns to the previous screen.

### State Persistence
- Timer state is NOT persisted to database
- Timer resets if app is force-closed
- This is intentional - rest timers are temporary workout aids

### Accessibility
- Large, high-contrast timer display
- Clear button labels
- Haptic feedback for non-visual confirmation
- Works with system accessibility settings

## Testing the Rest Timer

### Manual Test Steps

1. Navigate to active workout
2. Enter an exercise detail screen
3. Tap "Start Rest Timer" or complete a set (if auto-trigger is implemented)
4. Verify countdown starts
5. Tap pause - verify timer stops
6. Tap resume - verify timer continues
7. Tap +30s - verify 30 seconds added
8. Let timer complete - verify haptic feedback and auto-dismiss
9. Re-start timer, put app in background, return - verify time is accurate
10. Re-start timer, tap skip - verify returns to previous screen

### Edge Cases to Test

- [ ] Pause timer, background app, return - timer should remain paused
- [ ] Timer at 5 seconds, add 30s - should show 35 seconds
- [ ] Complete timer, quickly press +30s - should not add time (hasCompleted flag)
- [ ] Navigate to timer with duration=0 - should complete immediately
- [ ] Navigate to timer with very large duration (e.g., 3600) - should display correctly

## Future Enhancements

These features are NOT in Phase 3.3 but could be added later:

1. **Notifications**: Push notification when timer completes while app is backgrounded
2. **Sound Options**: Allow user to select completion sound
3. **Custom Durations**: Quick preset buttons (60s, 90s, 120s, 180s)
4. **Rest History**: Track average rest times per exercise
5. **Smart Suggestions**: Recommend rest time based on exercise type
6. **Animations**: Smooth circular progress animation
7. **Persistent Timer**: Keep timer in navigation bar/status
