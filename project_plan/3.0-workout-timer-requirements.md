# Phase 3.0: Workout Timer Requirements

## Overview

This document clarifies the workout session timer behavior and requirements for the Active Workout System.

---

## Workout Session Timer Flow

### 1. Start Workout Flow Screen (`/home/start-workout`)

**Key Features:**
- User can **add exercises to empty workout BEFORE starting**
- Show "Add Exercise" button prominently for empty workouts
- Allow exercise reordering before starting
- "Begin Workout" button starts the session and timer

**Actions:**
- When "Begin Workout" is pressed:
  1. Create `WorkoutSession` with `startTime = Date.now()`
  2. Navigate to Active Workout screen
  3. Timer begins immediately upon navigation

---

### 2. Active Workout Screen (`/home/active-workout`)

**Workout Timer Behavior:**
- Timer **STARTS** when user enters this screen from Start Workout Flow
- Timer displays elapsed time: `HH:MM:SS` format
- Timer runs **continuously** until:
  - User presses "Finish Workout" → stops timer, sets `endTime`, navigates to Summary
  - User cancels workout → stops timer, discards session
- If user navigates away (e.g., to Exercise Detail), timer **continues running in background**
- If app is backgrounded, timer **continues** (use background timer or calculate elapsed time on return)

**Timer Display:**
- Prominently shown at top of screen
- Format: `00:00:00` (hours:minutes:seconds)
- Color: Blue (#007AFF) to indicate active state
- Always visible, never hidden

**Rest Timer vs Workout Timer:**
- **Workout Timer**: Overall session duration (what we're tracking for the workout)
- **Rest Timer**: Countdown between sets (separate modal, does NOT affect workout duration)
- Both can run simultaneously
- Rest time is **NOT** subtracted from workout duration

---

### 3. Workout Summary Screen (`/home/workout-summary`)

**Duration Calculation:**
- `duration = endTime - startTime` (in seconds)
- Display as: "45 min 32 sec" or "1 hr 23 min"
- This is **total elapsed time**, including:
  - Exercise time
  - Rest periods
  - Navigation time
  - Any pauses or delays

**What is NOT included:**
- We do NOT subtract rest timer duration
- We do NOT track "active" vs "rest" time separately (in MVP)
- Total duration = time from "Begin Workout" to "Finish Workout"

---

## Database Schema Notes

### WorkoutSession Table

```typescript
{
  id: string;
  startTime: number;  // Unix timestamp - set when "Begin Workout" pressed
  endTime?: number;   // Unix timestamp - set when "Finish Workout" pressed
  duration?: number;  // Calculated: (endTime - startTime) in seconds
}
```

**Important:**
- `startTime` is set when user presses "Begin Workout" on Start Workout Flow screen
- `endTime` is set when user presses "Finish Workout" on Active Workout screen
- `duration` is calculated automatically: `duration = endTime - startTime`
- If `endTime` is `null`/`undefined`, workout is still in progress

---

## Implementation Requirements

### Phase 2.3: Starting a Workout from Template

**Start Workout Flow Screen must:**
1. Allow adding exercises to empty workout
2. Show "Add Exercise" button with exercise picker modal
3. Allow removing exercises before starting
4. Allow reordering exercises (drag and drop)
5. "Begin Workout" button creates session with `startTime`

### Phase 3.1: Workout Session Screen + Timer

**Active Workout Screen must:**
1. Start timer immediately when navigating from Start Workout Flow
2. Display timer in `HH:MM:SS` format
3. Update timer every second
4. Continue timer when user navigates to Exercise Detail
5. Save timer state if app is backgrounded
6. Stop timer and set `endTime` when "Finish Workout" is pressed
7. Stop timer and discard session when "Cancel Workout" is confirmed

### Phase 3.4: Workout Completion Flow

**Workout Summary Screen must:**
1. Calculate duration from `startTime` and `endTime`
2. Display duration prominently
3. Format duration in human-readable format (hr/min/sec)
4. Save `duration` to database when workout is saved

---

## User Experience Flow

### Happy Path:

1. **Home Screen** → Tap "Start Empty Workout"
2. **Start Workout Flow Screen**
   - See empty workout
   - Tap "Add Exercise"
   - Select exercises from picker
   - Reorder if needed
   - Tap "Begin Workout" ⏱️ **Timer starts here**
3. **Active Workout Screen**
   - Timer running: 00:00:00 → 00:00:01 → 00:00:02...
   - Tap on exercise to add sets
4. **Exercise Detail Screen**
   - Timer continues in background
   - Add sets, reps, weight
   - Tap "Done"
5. **Back to Active Workout Screen**
   - Timer still running: 00:12:34...
   - Complete more exercises
   - Tap "Finish Workout" ⏱️ **Timer stops here**
6. **Workout Summary Screen**
   - Shows: "Duration: 45 min 32 sec"
   - Tap "Save Workout"

---

## Edge Cases

### Resume Workout

If user exits app during workout:
- `WorkoutSession` remains in database with `endTime = null`
- On app restart, check for in-progress workout
- Show "Resume Workout" button on Home screen
- When resumed, calculate elapsed time from `startTime` to now
- Continue timer from that point

### Cancel Workout

If user cancels:
- Show confirmation dialog
- If confirmed:
  - Stop timer
  - Delete `WorkoutSession` from database
  - Navigate to Home screen
- If not confirmed:
  - Continue workout, timer keeps running

### Background Timer

Options for implementation:
1. **Calculate on return**: Store `startTime`, calculate elapsed when app returns to foreground
2. **Background task**: Use React Native background timer (may have platform limitations)
3. **Hybrid**: Calculate elapsed time on each screen mount

Recommended: **Option 1** (calculate on return) - simplest and most reliable

---

## Summary

- ✅ Workout timer STARTS when "Begin Workout" is pressed
- ✅ Timer runs continuously until "Finish Workout" or "Cancel"
- ✅ Duration = total elapsed time (including rest)
- ✅ User can add exercises to empty workout BEFORE starting
- ✅ Rest timer is separate and does NOT affect workout duration
- ✅ Timer continues when navigating between screens
- ✅ Timer state is preserved if app is backgrounded
